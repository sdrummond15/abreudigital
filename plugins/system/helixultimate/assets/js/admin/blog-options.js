/**
 * @package Helix Ultimate Framework
 * @author JoomShaper https://www.joomshaper.com
 * @copyright Copyright (c) 2010 - 2025 JoomShaper
 * @license http://www.gnu.org/licenses/gpl-2.0.html GNU/GPLv2 or Later
*/
jQuery((function(e){e(document).ready((function(){var a,t=e("#myTabTabs").find(">li").first();e('a[href="#attrib-helix_ultimate_blog_options"]').parent().insertAfter(t),(a=e("#jform_attribs_helix_ultimate_article_format label.active")).length>0&&a.click()})),e(".hu-image-field").each((function(a,t){var i=e(t);i.find(".btn-hu-image-upload").on("click",(function(e){e.preventDefault(),i.find(".hu-image-upload").click()})),i.find(".hu-image-upload").on("change",(function(a){a.preventDefault();var t=e(this),l=e(this).prop("files")[0],r=new FormData;r.append("option","com_ajax"),r.append("helix","ultimate"),r.append("request","task"),r.append("action","upload-blog-image"),r.append("format","json"),l.type.match(/image.*/)&&(r.append("image",l),e.ajax({type:"POST",data:r,contentType:!1,cache:!1,processData:!1,beforeSend:function(){t.prop("disabled",!0),i.find(".btn-hu-image-upload").attr("disabled","disabled");var a=e('<div class="hu-image-item-loader"><div class="progress" id="upload-image-progress"><div class="bar"></div></div></div>');i.find(".hu-image-upload-wrapper").addClass("loading").html(a)},success:function(a){var l=e.parseJSON(a);l.status?i.find(".hu-image-upload-wrapper").removeClass("loading").empty().html(l.output):i.find(".hu-image-upload-wrapper").removeClass("loading").empty();var r=i.find(".hu-image-upload-wrapper").find(">img");r.length?(e(".hu-image-field").removeClass("hu-image-field-empty").addClass("hu-image-field-has-image"),i.find("#jform_attribs_helix_ultimate_image").val(r.data("src"))):(e(".hu-image-field").removeClass("hu-image-field-has-image").addClass("hu-image-field-empty"),i.find("#jform_attribs_helix_ultimate_image").val("")),t.val(""),t.prop("disabled",!1),i.find(".btn-hu-image-upload").removeAttr("disabled")},xhr:function(){return myXhr=e.ajaxSettings.xhr(),myXhr.upload?myXhr.upload.addEventListener("progress",(function(a){e("#upload-image-progress").find(".bar").css("width",Math.floor(a.loaded/a.total*100)+"%")}),!1):alert("Uploadress is not supported."),myXhr},error:function(){i.find(".hu-image-upload-wrapper").empty(),t.val("")}})),t.val("")}))})),e(document).on("click",".btn-hu-image-remove",(function(a){a.preventDefault();var t=e(this).closest(".hu-image-field");if(1==confirm("You are about to delete this item permanently. 'Cancel' to stop, 'OK' to delete.")){var i={option:"com_ajax",helix:"ultimate",request:"task",action:"remove-blog-image",src:t.find(".sp-image-upload-wrapper").find(">img").data("src"),format:"json"};e.ajax({type:"POST",data:i,success:function(a){var i=e.parseJSON(a);i.status?(t.find(".hu-image-upload-wrapper").empty(),e(".hu-image-field").removeClass("hu-image-field-has-image").addClass("hu-image-field-empty"),t.find("#jform_attribs_helix_ultimate_image").val("")):alert(i.output)}})}})),e(".btn-hu-gallery-item-upload").on("click",(function(a){a.preventDefault(),e("#hu-gallery-item-upload").click()})),e("#hu-gallery-item-upload").on("change",(function(a){a.preventDefault();var t=e(this),l=e(this).prop("files");Joomla.getOptions("system.paths");for(i=0;i<l.length;i++){var r=l[i].name.split(".").pop().toLowerCase();if("png"==r||"jpg"==r||"jpeg"==r||"gif"==r||"svg"==r||"webp"==r){let a="gallery-id-"+Math.floor(1e6*Math.random()+1);var o=new FormData;o.append("option","com_ajax"),o.append("helix","ultimate"),o.append("request","task"),o.append("action","upload-blog-image"),o.append("image",l[i]),o.append("index",a),o.append("gallery",!0),o.append("format","json"),e.ajax({type:"POST",data:o,contentType:!1,cache:!1,processData:!1,beforeSend:function(){var t=e('<li class="hu-gallery-item loading" id="'+a+'"><div class="progress"><div class="bar"></div></div></li>');e(".hu-gallery-items").append(t)},success:function(t){var i=e.parseJSON(t);i.status?e("#"+a).attr("data-src",i.data_src).removeClass("loading").empty().html(i.output):(e("#"+a).remove(),alert(i.output));let l=[];e(".hu-gallery-items").find(">.hu-gallery-item").each((function(a,t){l.push('"'+e(t).data("src")+'"')}));let r='{"helix_ultimate_gallery_images":['+l+"]}";e("#jform_attribs_helix_ultimate_gallery").val(r)},xhr:function(){return myXhr=e.ajaxSettings.xhr(),myXhr.upload?myXhr.upload.addEventListener("progress",(function(t){e("#"+a).find(".bar").css("width",Math.floor(t.loaded/t.total*100)+"%")}),!1):console.log("Uploadress is not supported."),myXhr}})}}t.val("")})),e(".hu-gallery-items").sortable({stop:function(a,t){let i=[];e(".hu-gallery-item").each((function(a,t){i.push('"'+e(t).data("src")+'"')}));let l='{"helix_ultimate_gallery_images":['+i+"]}";e("#jform_attribs_helix_ultimate_gallery").val(l)}}),e(document).on("click",".btn-hu-remove-gallery-image",(function(a){a.preventDefault();var t=e(this);if(1==confirm("You are about to delete this item permanently. 'Cancel' to stop, 'OK' to delete.")){var i={option:"com_ajax",helix:"ultimate",request:"task",action:"remove-blog-image",src:t.parent().data("src"),format:"json"};e.ajax({type:"POST",data:i,success:function(a){var i=e.parseJSON(a);if(i.status){t.parent().remove();let a=[];e(".hu-gallery-item").each((function(t,i){a.push('"'+e(i).data("src")+'"')}));let i='{"helix_ultimate_gallery_images":['+a+"]}";e("#jform_attribs_helix_ultimate_gallery").val(i)}else alert(i.output)}})}}))}));